import {DotenvConfigOptions} from 'dotenv';
import {DynamicModule, Global, Module} from '@nestjs/common';
import {
   CONFIG_CLASS_FINDER, CONFIG_FILE_READER, CONFIG_TYPES, CONFIGURATION_FACTORY, DOTENV_CONFIG_OPTIONS
} from './config.constants';
import {ConfigFileReaderService} from '../config-file-reader.service';
import {ConfigurationFactoryService} from '../configuration-factory.service';
import {ConfigClassFinderService} from '../config-class-finder.service';

@Global()
@Module({})
export class CoreConfigModule {
   protected static defaultGlob: string = 'config/**/!(*.d).{ts,js}';

   static forRoot(loadConfigGlob: string, dotenvOptions?: DotenvConfigOptions, resolveGlobRoot?: string ): DynamicModule {
      return {
         module: CoreConfigModule,
         providers: [
            {
               provide: DOTENV_CONFIG_OPTIONS,
               useValue: dotenvOptions
            },
            {
               provide: CONFIG_FILE_READER,
               useClass: ConfigFileReaderService
            },
            {
               provide: CONFIGURATION_FACTORY,
               useClass: ConfigurationFactoryService
            },
            // {
            //    provide: CONFIG_CLASS_FINDER,
            //    useClass: ConfigClassFinderService
            // },
         ]
      }
   }

}